# Semantic Release TUI

A Terminal User Interface (TUI) version of the semantic release tool built with Rust and Ratatui. This tool replicates the functionality of the original Node.js version with Monday.com integration and AI-powered release notes generation.

## Features

- üöÄ **Interactive TUI**: Beautiful terminal interface built with Ratatui
- üìã **Commit Management**: Create semantic commits with Monday.com task integration
- ü§ñ **Dual AI Analysis**: 
  
  - **Comprehensive Analysis**: Single API call with JSON response for all fields (`t` key)
- üîç **Task Search**: Search and select Monday.com tasks directly from the TUI
- ‚öôÔ∏è **Configuration**: Easy setup for API keys and settings
- üéØ **Git Integration**: Analyze commits and manage repository operations
- üîÑ **Background Processing**: Non-blocking AI analysis with real-time progress updates
- üìù **Auto-Population**: Automatic form filling from AI analysis results

## Installation

Make sure you have Rust installed, then:

```bash
cargo build --release
```

## Configuration

First, configure your API keys and settings:

```bash
cargo run -- config
```

You'll be prompted to enter:
- Monday.com API Key
- Monday.com Account Slug (subdomain)
- Monday.com Board ID (optional)
- Google Gemini API Token (optional for AI features)

Configuration is stored in `.env` file in the current directory (same as original project)

## Usage

### Interactive TUI Mode

Run the TUI interface:

```bash
cargo run
# or
cargo run -- tui
```

**Navigation:**
- `Tab`/`Shift+Tab`: Navigate between fields
- `‚Üë`/`‚Üì`: Navigate commit types and tasks
- `Enter`: Confirm selection or commit
- `q`: Quit application
- `Esc`: Go back/cancel

**Commit Screen Key Bindings:**
- `r`: **AI Analysis** - 5 parallel Gemini API calls (title, type, description, security, breaking changes)
- `t`: **Comprehensive Analysis** - Single Gemini API call returning complete JSON analysis
- `s`: Search Monday.com tasks
- `c`: Preview commit message
- `m`: Toggle task management mode
- `Space`/`Delete`: Remove selected tasks (in task management mode)

### Command Line Interface

#### Create Commits (Opens TUI directly to commit screen)

```bash
cargo run -- commit
```

#### Auto-commit (AI analysis + commit editor in one command)

```bash
cargo run -- --autocommit
```
*Runs comprehensive AI analysis automatically and opens the commit editor with pre-filled fields*

#### Generate Release Notes (Opens TUI directly to release notes screen)

```bash
cargo run -- release-notes
```

#### Search Monday.com Tasks

```bash
cargo run -- search "task name"
```

#### Debug Commands

```bash
# Test Monday.com connection
cargo run -- debug monday

# Test Gemini AI connection
cargo run -- debug gemini

# Test Git repository
cargo run -- debug git

# Test commit creation with detailed logs
cargo run -- debug commit
```

## TUI Screens

### Main Screen
Welcome screen with navigation tabs for different features.

### Commit Screen
Interactive commit creation with:
- **Commit Type Selection**: feat, fix, docs, style, refactor, perf, test, chore, revert
- **Scope Input**: Auto-populated from AI analysis or manual entry
- **Title**: Auto-generated by AI or manual entry
- **Description**: Multi-line field with AI generation support
- **Breaking Changes**: Auto-detected by AI analysis
- **Test Details**: Multi-line field for test information
- **Security Analysis**: Auto-generated security risk assessment
- **Slow Migrations**: Details about database migrations
- **Parts to Execute**: Deployment instructions
- **Monday.com Tasks**: Integrated task selection and management

### AI Analysis Features



#### Comprehensive Analysis (`t` key)
- **Single API Call** with detailed prompt
- **JSON Response** containing all fields:
  ```json
  {
    "title": "concise Spanish title (‚â§50 chars)",
    "commitType": "semantic release type",
    "description": "exhaustive technical description (‚â•150 words)",
    "scope": "code area affected",
    "securityAnalysis": "security vulnerabilities or empty",
    "breakingChanges": "compatibility breaking changes or empty"
  }
  ```
- **Auto-Population** of all form fields simultaneously
- **Fallback Handling** for malformed responses

### Task Management
- **Real-time Search**: Search Monday.com tasks as you type
- **Multi-select Interface**: Choose multiple tasks per commit
- **Task Details**: View task status, board, and metadata
- **Management Mode**: Use `m` key to enter task management mode
  - Navigate with `‚Üë`/`‚Üì`
  - Remove tasks with `Space`/`Delete`/`r`
  - Exit with `m`

### Release Notes Generation
- **Internal Generation**: Press `Enter` for Rust-based generation
- **External Script**: Press `o` for Node.js script compatibility
- **AI Processing**: Automatic Gemini AI enhancement of release notes
- **Background Processing**: Non-blocking generation with progress updates

## Background Processing

All long-running operations use background threads:

### AI Analysis Status Messages
- üîç "Analizando cambios en el repositorio..."
- üåê "Conectando con Gemini AI..."
- üß† "Generando an√°lisis completo de commit..."
- ‚úÖ "An√°lisis completado exitosamente"

### Release Notes Status Messages
- üìã "Obteniendo commits desde la √∫ltima versi√≥n..."
- üè∑Ô∏è "Obteniendo √∫ltima etiqueta del repositorio..."
- üìä "Analizando commits desde la √∫ltima versi√≥n..."
- üîç "Extrayendo IDs de tareas de Monday.com..."
- üìÑ "Generando documento estructurado para versi√≥n..."
- ü§ñ "Enviando documento a Google Gemini API..."
- ‚úÖ "Notas de versi√≥n generadas exitosamente"

## Commit Message Format

The tool follows the same commit format as the original:

```
type(scope): description

Detailed description if necessary

BREAKING CHANGE: Details if applicable

Test Details: Description of tests
Security: Security information or NA
Slow Migrations: Migration details
Parts to Execute: Deployment instructions

MONDAY TASKS:
- Task Title (ID: 123456) - https://account.monday.com/boards/board/pulses/task
```

## Release Notes Generation

The tool generates multiple files in the `release-notes/` directory:

1. **Structured Documents**:
   - `release-notes-YYYY-MM-DD_SCRIPT_WITH_ENTER_KEY.md` - Internal Rust generation
   - `release-notes-YYYY-MM-DD_SCRIPT.md` - Node.js script compatible

2. **AI-Enhanced Versions**:
   - `release-notes-YYYY-MM-DD_GEMINI.md` - AI-processed professional release notes

## Architecture

### Core Technologies
- **Ratatui**: Terminal UI framework with custom components
- **Tokio**: Async runtime for concurrent API calls
- **Git2**: Git repository operations and analysis
- **Reqwest**: HTTP client for API communications
- **Serde**: JSON serialization/deserialization
- **Crossterm**: Cross-platform terminal control
- **Clap**: Command-line argument parsing

### Key Components
- **Background Operations**: Thread-safe state management with `Arc<Mutex>`
- **UI State Management**: Comprehensive state tracking for all interactions
- **Error Handling**: Graceful fallbacks and user-friendly error messages
- **Git Integration**: Advanced commit analysis and repository operations

## API Integrations

### Monday.com API
- **Global Task Search**: Search across all accessible boards
- **Board-Specific Search**: Search within specific board if configured
- **Task Details**: Fetch comprehensive task information including:
  - Task title, status, and metadata
  - Board information and URLs
  - Task updates and activity
  - Column values and custom fields

### Google Gemini API
- **Dual Model Support**: 
  - Primary: `gemini-2.5-pro-preview-06-05`
  - Fallback: `gemini-2.0-flash`
- **Advanced Prompt Engineering**: Highly detailed prompts for accurate analysis
- **JSON Response Parsing**: Robust handling of structured responses
- **Error Recovery**: Automatic fallback with sensible defaults
- **Security Analysis**: Comprehensive vulnerability assessment
- **Breaking Change Detection**: Automatic compatibility impact analysis

## Error Handling & Recovery

The application provides comprehensive error handling:

### Configuration Errors
- Missing API keys with setup guidance
- Invalid configuration with correction suggestions
- Network connectivity issues with retry options

### API Errors
- **Monday.com**: Connection failures, rate limiting, invalid queries
- **Gemini**: Model unavailability, quota exceeded, malformed responses
- **Git**: Repository access, commit parsing, tag analysis

### Recovery Mechanisms
- **Automatic Fallbacks**: Secondary models, default values, offline mode
- **User Guidance**: Clear error messages with actionable solutions
- **Graceful Degradation**: Core functionality continues without optional features

## Development

### Setup
```bash
git clone <repository>
cd semantic-release
cargo build
```

### Testing
```bash
cargo test          # Run unit tests
cargo check         # Check compilation
cargo clippy        # Linting
cargo fmt           # Code formatting
```

### Debugging
```bash
# Enable debug logging
cargo run -- --debug commit

# Enable verbose logging
cargo run -- --verbose tui
```

## Performance Optimizations

- **Parallel API Calls**: Concurrent Gemini requests for faster analysis
- **Background Processing**: Non-blocking UI with threaded operations
- **Efficient State Management**: Minimal UI redraws and optimized rendering
- **Caching**: Git operations and API responses where appropriate
- **Memory Management**: Careful handling of large commit histories and task lists

## Comparison with Original

This Rust TUI version provides:

### Enhanced Features
- ‚úÖ **Interactive TUI** instead of command-line prompts
- ‚úÖ **Real-time AI Analysis** with progress feedback
- ‚úÖ **Dual Analysis Modes** (multi-call vs comprehensive)
- ‚úÖ **Background Processing** for responsive UI
- ‚úÖ **Advanced Task Management** with visual selection
- ‚úÖ **Auto-form Population** from AI analysis
- ‚úÖ **Improved Error Handling** with graceful recovery

### Full Compatibility
- ‚úÖ **Same API Integrations** (Monday.com + Gemini)
- ‚úÖ **Compatible Commit Format** with original
- ‚úÖ **Same Configuration System** (.env file)
- ‚úÖ **Same Release Notes Structure** and content
- ‚úÖ **CLI Command Compatibility** for automation

### Performance Improvements
- ‚ö° **Parallel Processing** for faster AI analysis
- ‚ö° **Background Operations** for responsive interface
- ‚ö° **Efficient Git Operations** with native Git2 library
- ‚ö° **Optimized Network Calls** with proper error handling

## Troubleshooting

### Common Issues

1. **TUI Not Opening**
   ```bash
   # Check terminal compatibility
   echo $TERM
   # Try with different terminal
   cargo run -- commit
   ```

2. **AI Analysis Failures**
   ```bash
   # Test Gemini connection
   cargo run -- debug gemini
   # Check API key configuration
   cargo run -- config
   ```

3. **Monday.com Integration Issues**
   ```bash
   # Test Monday connection
   cargo run -- debug monday
   # Verify API key and account slug
   ```

4. **Git Repository Problems**
   ```bash
   # Test Git integration
   cargo run -- debug git
   # Ensure you're in a Git repository
   ```

## License

Same license as the original project. 